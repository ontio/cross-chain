<h1 align="center">Ontology Cross Chain - ethereum cross chain specification</h1>
<h4 align="center">Version 1.0 </h4>

[English](ethereum cross chain specification.md) | 中文

以太跨链到其他链或者其他链跨链到以太都是通过中继链进行，在这里主要介绍以太和中继链的技术规范，包括以太跨链到中继链以及中继链跨链到以太。

## 背景

### 轻客户端和Merkel证明

如何证明以太上确实发生了什么事情？Merkel证明。将以太上发生的事件或者消息存储下来，以太会生成该存储的merkel证明，有了merkel证明和正确的以太区块头，我们就可以验证该事件或者消息确实在以太发生了。

中继链也是一样。通过merkel证明和区块头可以证明一个事件或者消息确实在中继链发生了。

## 原理

如果我们在中继链有了正确的以太区块头，对于以太发生的事件或者消息，通过提交其merkel证明，中继链就可以知道该事件确实在以太链上发生，这就是以太跨链到中继链。包括两个主要部分，同步以太区块头到中继链，提交以太跨链的merkel证明到中继链。

中继链到以太原理一样，如果我们在以太上有了正确的中继链区块头，对于中继链发生的事件或者消息，通过提交其merkel证明，以太就知道该事件确实在中继链发生，这就是中继链跨链到以太。也包括了两个主要部分，同步中继链区块头到以太，提交中继链跨链的merkel证明到以太。

关于谁同步区块头和谁提交跨链交易，这里需要一个relayer，它监听以太链并同步其区块头到到中继链，监听以太链上发生的跨链事件，并提交到中继链。它还需要监听中继链并同步需要的区块头到以太，监听中继链上需要跨链到以太的事件并提交到以太。

### 以太区块头同步到中继链

以太区块头同步到中继链需要首先指定一个以太同步初始区块头，从这个区块头开始同步后续的以太区块头。所以包括同步初始区块头和同步区块头。
以太同步区块头到中继链：
![](https://github.com/blockchain-develop/cross-chain/blob/master/ethereum/pic/sync%20header1.png)

以太同步区块头到中继链需要一个一个区块头进行，中继链使用了以太的轻客户端原理来验证以太区块头的正确性，包括以太区块头的POW。

分叉是允许的，只要回到以太主链上的区块头一个一个同步就可以，中继链可以处理以太的分叉。

### 中继链区块头同步到以太链

中继链区块头同步到以太也一样需要首先指定一个中继链初始区块头，从这个区块头开始同步中继链区块头，也包括同步初始区块头和同步区块头。

中继链区块头同步到以太链：
![](https://github.com/blockchain-develop/cross-chain/blob/master/ethereum/pic/sync%20header2.png)

中继链区块头同步到以太有些不一样，并不需要一个一个区块头同步，只有需要区块头才被同步。什么是需要的区块头呢？有发生验证节点变更的区块头和包含跨链到以太交易的区块头，需要同步到以太。因为中继链是具备终局性的区块链。

### 从以太跨链到中继链

从以太跨链到中继链，需要在以太上发起一笔交易，在以太到BTC的跨链中，调用以太跨链BTC的业务合约的lock，同时需要生成事件并且写入到以太的存储中来生成该事件的merkel proof。有了上面同步到中继链的以太区块头，那么中继链可以验证以太的这个事件。 当然需要relayer监听以太的跨链事件并提交跨链事件的merkel proof到中继链。

以太跨链到中继链：
![](https://github.com/blockchain-develop/cross-chain/blob/master/ethereum/pic/cross.png)

### 从中继链跨链到以太

监听中继链0300000000000000000000000000000000000000合约的跨链到以太事件，提交跨链以太事件以及其merkel proof到以太来验证事件。在BTC到以太的跨链中，提交跨链以太事件以及其merkel proof到以太的跨链管理合约verifyAndExecuteTx的来完成。

## 许可证

Ontology遵守GNU Lesser General Public License, 版本3.0。 详细信息请查看项目根目录下的LICENSE文件。
